
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0">
		<link rel="stylesheet" type="text/css" href="./style/columns.css"/>
		<title>Router: Deferred</title>
		<style>
			#state {
				border:0px solid black;
				outline:1px dotted #212121;
			}
		</style>
	</head>
	<body>
		<div class="modal container">
			<div class="container">
				<section class="content">
					<select id="state" multiple=true size=20>
						<option>#/begin</option>
						<option>#/1</option>
						<option>#/1/2</option>
						<option>#/1/2/3</option>
						<option>#/1/2/3/4</option>
						<option>#/end</option>
					</select>
				</section>
				<section class="void">
					<div class="container">
						<section class="content">
							<header class="header">Output</header>
							<section class="scroll" id="output">
							</section>
						</section>
						<section class="void"></section>
					</div>
				</section>
			</div>
		</div>	
		
		<script type="module">
			
			import { Router } from '../source/router.js'
			import { install as install_logging } from '../../logger/source/logging.js'
			
			class Example {
				
				constructor() {
					
					let router = new Router()
					install_logging('#output')
					this.prepare_inputs()
					this.watch(router)
				}
				
				prepare_inputs() {
					
					document.querySelector('#state').onchange = function(element) {
						window.location.hash = this.value
						return false
					}
				}
				
				watch(router) {
					
					this.one(router)
					router.enter('begin', function() {
						console.log('enter begin')
					})
					router.exit('begin', function() {
						console.log('exit begin')
					})
					router.enter('end', function() {
						console.log('enter end')
					})
					router.exit('end', function() {
						console.log('exit end')
					})
				}
				
				one(router) {
					
					let result = [null, null]
					let offs
					result[0] = router.enter('1', function() {
						console.log('enter 1')
						offs = this.two(router)
					}.bind(this))
					result[1] = router.exit('1', function() {
						console.log('exit 1')
						offs[0]()
						offs[1]()
					})
					return result
				}
				
				two(router) {
					
					let result = [null, null]
					let offs
					result[0] = router.enter('1/2', function() {
						console.log('enter 1/2')
						offs = this.three(router)
					}.bind(this))
					result[1] = router.exit('1/2', function() {
						console.log('exit 1/2')
						offs[0]()
						offs[1]()
					})
					return result
				}
				
				three(router) {
					
					let result = [null, null]
					let offs
					result[0] = router.enter('1/2/3', function() {
						console.log('enter 1/2/3')
						offs = this.four(router)
					}.bind(this))
					result[1] = router.exit('1/2/3', function() {
						console.log('exit 1/2/3')
						offs[0]()
						offs[1]()
					})
					return result
				}
				
				four(router) {
					
					let result = [null, null]
					let offs
					result[0] = router.enter('1/2/3/4', function() {
						console.log('enter 1/2/3/4')
					}.bind(this))
					result[1] = router.exit('1/2/3/4', function() {
						console.log('exit 1/2/3/4')
					})
					return result
				}
			}
			
			new Example()
			
		</script>
	</body>
</html>

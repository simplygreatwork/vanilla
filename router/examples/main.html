
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0">
		<link rel="stylesheet" type="text/css" href="./style/columns.css"/>
		<title>Router: Main</title>
		<style>
			#state {
				border:0px solid black;
				outline:1px dotted #212121;
			}
		</style>
	</head>
	<body>
		<div class="modal container">
			<div class="container">
				<section class="content">
					<select id="state" multiple=true size=20>
						<option>#/1</option>
						<option>#/1/2</option>
						<option>#/1/2/3</option>
						<option>#/11</option>
						<option>#/11/22</option>
						<option>#/11/22/33</option>
						<option>#/111</option>
						<option>#/111/222</option>
						<option>#/111/222/333</option>
						<option>#/111/222/333/444/555</option>
						<option>#/111/222/666/777/888</option>
						<option>#/products</option>
						<option>#/products/a</option>
						<option>#/products/a/features</option>
						<option>#/products/a/features/b</option>
					</select>
				</section>
				<section class="void">
					<div class="container">
						<section class="content">
							<header class="header">Output</header>
							<section class="scroll" id="output">
							</section>
						</section>
						<section class="void"></section>
					</div>
				</section>
			</div>
		</div>	
		
		<script type="module">
			
			import { Router } from '../source/router.js'
			import { install as install_logging } from '../../logger/source/logging.js'
			
			class Example {
				
				constructor() {
					
					let router = new Router()
					install_logging('#output')
					this.prepare_inputs()
					this.watch(router)
				}
				
				prepare_inputs() {
					
					document.querySelector('#state').onchange = function(element) {
						window.location.hash = this.value
						return false
					}
				}
				
				watch(router) {
					
					router.enter('1', function() {
						console.log('enter 1')
					})
					router.exit('1', function() {
						console.log('exit 1')
					})
					router.enter('1/2', function() {
						console.log('enter 1/2')
					})
					router.exit('1/2', function() {
						console.log('exit 1/2')
					})
					router.enter('1/2/3', function() {
						console.log('enter 1/2/3')
					})
					router.exit('1/2/3', function() {
						console.log('exit 1/2/3')
					})
					router.enter('products', function() {
						console.log(`enter products`)
					})
					router.exit('products', function() {
						console.log(`exit products`)
					})
					router.enter('products/:pid', function({values}) {
						console.log(`enter product id "${values.pid}"`)
					})
					router.exit('products/:pid', function({values}) {
						console.log(`exit product id "${values.pid}"`)
					})
					router.enter('products/:pid/features', function({values}) {
						console.log(`enter features of "${values.pid}"`)
					})
					router.exit('products/:pid/features', function({values}) {
						console.log(`exit features of "${values.pid}"`)
					})
					router.enter('products/:pid/features/:fid', function({values}) {
						console.log(`enter feature id "${values.fid}" of "${values.pid}"`)
					})
					router.exit('products/:pid/features/:fid', function({values}) {
						console.log(`exit feature id "${values.fid}" of "${values.pid}"`)
					})
					// router.enter('**', function() {
					// 	console.log('enter unknown')
					// })
					// router.exit('**', function() {
					// 	console.log('exit unknown')
					// })
				}
				
				test() {
					
					console.log('result: ' + new RegExp('products').exec('products'))
					console.log('result: ' + new RegExp('products').exec('products/a'))
					console.log('result: ' + new RegExp('products').exec('products/a/features'))
					console.log('result: ' + new RegExp('products').exec('products/a/features/b'))
					console.log('result: ' + new RegExp('products\/([^/]+)').exec('products'))
					console.log('result: ' + new RegExp('products\/([^/]+)').exec('products/a'))
					console.log('result: ' + new RegExp('products\/([^/]+)').exec('products/a/features'))
					console.log('result: ' + new RegExp('products\/([^/]+)').exec('products/a/features/b'))
					console.log('result: ' + new RegExp('products\/(.+)\/features').exec('products'))
					console.log('result: ' + new RegExp('products\/(.+)\/features').exec('products/a'))
					console.log('result: ' + new RegExp('products\/(.+)\/features').exec('products/a/features'))
					console.log('result: ' + new RegExp('products\/(.+)\/features').exec('products/a/features/b'))
					console.log('result: ' + new RegExp('products\/(.+)\/features\/(.+)').exec('products'))
					console.log('result: ' + new RegExp('products\/(.+)\/features\/(.+)').exec('products/a'))
					console.log('result: ' + new RegExp('products\/(.+)\/features\/(.+)').exec('products/a/features'))
					console.log('result: ' + new RegExp('products\/(.+)\/features\/(.+)').exec('products/a/features/b'))
				}
			}
			
			new Example()
			
		</script>
	</body>
</html>
